# Fall Detection on FPGA (OV7670 + Artix-7)

הפרויקט עוסק בלכידת וידאו בזמן אמת ממצלמת **OV7670**, הצגת התמונה על מסך **VGA**,  
ובהמשך הוספת לוגיקת **זיהוי נפילה (Fall Detection)** על גבי ה-FPGA.

המערכת שקיבלנו הייתה חצי-מוכנה:
- מצלמה → FPGA → VGA כבר עובדים
- המשימה שלנו: להוסיף שלב עיבוד (Processing) שיזהה נפילה.

---

## 🎯 מטרות הפרויקט

1. חיבור מצלמת OV7670 ללוח FPGA (Nexys-A7 / Basys3/Artix-7).
2. הגדרת המצלמה דרך ממשק SCCB (I²C).
3. לכידת פריימים מהמצלמה ושמירתם בזיכרון (Block RAM).
4. הצגת וידאו חי על מסך VGA.
5. פיתוח לוגיקת **Fall Detection** על בסיס זרם הווידאו.
6. אינטגרציה של כל החלקים למערכת אחת בזמן-אמת.

---

## 🧱 מבנה המערכת (High-Level Block Diagram)

הרעיון הכללי:

1. **OV7670 Camera**  
   → שולחת פיקסלים + אותות סנכרון (PCLK, VSYNC, HREF).

2. **Configuration (ov7670_configuration + i2c_master/sccb_master)**  
   → כותבים רגיסטרים במצלמה (רזולוציה, פורמט צבע וכו') דרך SCCB/I²C.

3. **Capture (ov7670_capture_2)**  
   → דוגם את הפיקסלים לפי PCLK ו-HREF, ממיר לפורמט פנימי ושומר בזיכרון.

4. **Frame Buffer (blk_mem_gen_0)**  
   → Block RAM שמחזיק את הפריים (או חלק ממנו).

5. **Fall Detection (to be added)**  
   → מודול חדש שיקרא פיקסלים מה-Frame Buffer, יבצע עיבוד (גרייסקייל, השוואת פריימים וכו’)  
     ויחזיר אינדיקציה לנפילה / ישנה את התמונה (למשל מסגרת אדומה סביב נופל).

6. **VGA Controller (vga_controller_2)**  
   → מוציא אותות VGA (HSYNC, VSYNC, RGB) מתוך הנתונים שב-Frame Buffer.

7. **Top Level (top_2)**  
   → מחבר את כל המודולים: מצלמה, זיכרון, עיבוד, VGA, שעונים ואילוצים.

---

## 📂 קבצים עיקריים במערכת

| קובץ | תיאור קצר |
|------|-----------|
| `top_2.vhd` | הטופ-לבל – מחבר מצלמה, Capture, זיכרון, Fall Detection, VGA וכל השעונים. |
| `OV7670_fsm.vhd` | FSM לבקרת תהליך הגדרת המצלמה ו/או זרימת הנתונים. |
| `ov7670_configuration.vhd` | טבלת הרגיסטרים והלוגיקה לכתיבה למצלמה דרך SCCB. |
| `i2c_master.vhd` | בקר I²C כללי (אותות SCL/SDA). |
| `sccb_master.vhd` | עטיפה לפרוטוקול SCCB הספציפי למצלמת OV7670. |
| `ov7670_capture_2.vhd` | לוגיקת לכידת הפיקסלים מהמצלמה וכתיבה ל-Frame Buffer. |
| `vga_controller_2.vhd` | יצירת אותות VGA (HSYNC, VSYNC, X/Y) וקריאת פיקסלים מהזיכרון. |
| `blk_mem_gen_0.xci` | IP של Block RAM – משמש כ-Frame Buffer. |
| `Nexys-A7-100T-Master.xdc` | קובץ אילוצים: שעונים, פינים של מצלמה, פינים של VGA, כפתורים/LED. |
| `*_tb.vhd` | טסטבנצים לסימולציה (למשל `vga_controller_tb.vhd`, `ov7670_capture_tb.vhd`). |

---

## 🚀 מה כבר עובד (במצב שקיבלנו)

- ✅ מצלמת OV7670 מוגדרת בהצלחה (SCCB/I²C).  
- ✅ פיקסלים נקלטים ונשמרים בזיכרון.  
- ✅ יציאת VGA מציגה תמונה מהמצלמה על המסך.  
- ✅ קיימים טסטבנצים בסיסיים ל-VGA ול-Capture.

---

## 🟥 מה אנחנו מוסיפים – Fall Detection

שלב העיבוד שצריך לפתח:

1. **קריאת פריימים מה-Frame Buffer**  
   - שימוש בפורט נוסף של ה-BRAM או בקרת גישה מתוזמנת.

2. **עיבוד בסיסי** (לדוגמה – רעיונות אפשריים):  
   - המרה ל-Grayscale.  
   - השוואת פריים נוכחי לפריים קודם (Frame differencing).  
   - סינון רעשים (Threshold / פילטר פשוט).  
   - חישוב מרכז מסה/זווית של דמות והבנת “נפילה” (שינוי פתאומי בכיוון/גובה).

3. **החלטה על נפילה**  
   - יצירת סיגנל `fall_detected`  
   - או שינוי התמונה (למשל צביעה/מסגרת) כדי להראות נפילה במסך.

4. **אינטגרציה**  
   - חיבור מודול Fall Detection לטופ־לבל.  
   - הצגת תוצאה על VGA (טקסט/צבע/מסגרת).  
   - אפשר גם להדליק LED בלוח בזמן נפילה.

---

## ▶️ איך מריצים את המערכת (High-Level Flow)

1. לפתוח Vivado וליצור פרויקט חדש ללוח המתאים.  
2. להוסיף לפרויקט את כל קבצי ה-VHDL + קובצי ה-IP.  
3. להגדיר את קובץ ה-XDC (`Nexys-A7-100T-Master.xdc`).  
4. להריץ Synthesis → Implementation → Generate Bitstream.  
5. לחבר מצלמת OV7670 ללוח (פינים לפי ה-XDC).  
6. לחבר מסך VGA.  
7. להעלות את ה-bitstream ללוח.  
8. לוודא קודם שהתמונה הבסיסית מהמצלמה נראית.  
9. לאחר הוספת Fall Detection – לבדוק על סצנות של אדם עומד / הולך / נופל.

---

## 🤝 עבודה משותפת בגיטהאב (אנחנו + שותף)

- כל פיצ’ר חדש → Branch חדש (`feature/fall-detection`, `feature/grayscale` וכו’).  
- ביצוע שינויים, הוספת קבצים → `commit`.  
- פתיחת Pull Request ומעבר יחד על הקוד.  
- merge ל-`main` רק אחרי שסימולציה/טסטים עברו.

---

## 👥 צוות

- **Yosi Brim** – FPGA / VHDL / אינטגרציה.  
- **[שם השותף]** – FPGA / אלגוריתמי Fall Detection.  

---

## 📌 רשימת משימות (To-Do)

- [ ] להבין לעומק את `top_2.vhd` ואת הנתיב של הפיקסלים.  
- [ ] לתכנן ממשק למודול Fall Detection מול הזיכרון.  
- [ ] ליישם עיבוד בסיסי (Grayscale + Frame Differencing).  
- [ ] להגדיר קריטריון “נפילה” ולהוציא סיגנל `fall_detected`.  
- [ ] להציג חיווי נפילה על מסך ה-VGA / LED.  
- [ ] לכתוב טסטבנץ בסיסי למודול Fall Detection.  
